# Тесты для RIT-Utils

Этот каталог содержит комплексные pytest тесты для приложения RIT-Utils.

## Структура тестов

- `conftest.py` - Конфигурация pytest и фикстуры
- `test_auth_*.py` - Тесты модулей аутентификации
- `test_utils_*.py` - Тесты утилит
- `test_integration_*.py` - Интеграционные тесты
- `test_main.py` - Тесты основного модуля
- `test_config.py` - Тесты конфигурации

## Запуск тестов

### Все тесты
```bash
poetry run pytest
```

### Конкретный файл тестов
```bash
poetry run pytest tests/test_auth_login.py
```

### Конкретный тест
```bash
poetry run pytest tests/test_auth_login.py::TestLoginHandler::test_login_success_with_2fa_configured
```

### С покрытием кода
```bash
poetry run pytest --cov=src
```

### Только быстрые тесты
```bash
poetry run pytest -m "not slow"
```

## Особенности тестов

### Моки и фикстуры
- Все внешние зависимости замокированы (SMTP, LibreOffice, файлы)
- Тесты не требуют реального запуска приложения
- Используются тестовые переменные окружения

### Покрытие
Тесты покрывают:
- ✅ Аутентификацию и авторизацию  
- ✅ Двухфакторную аутентификацию
- ✅ Отправку email
- ✅ Генерацию сертификатов
- ✅ Генерацию форм врачей
- ✅ Обработку ошибок
- ✅ FastAPI endpoints
- ✅ Cookie обработку

### Изоляция тестов
- Тесты не влияют друг на друга
- Автоматическая очистка состояния между тестами
- Отдельная тестовая среда

## Переменные окружения для тестов

Тесты используют следующие тестовые переменные:
- `JWT_SECRET_KEY` - Секретный ключ для JWT
- `LOGIN/PASSWORD` - Тестовые учетные данные
- `TOTP_SECRET` - Секрет для 2FA
- `SEND_FROM/EMAIL_PASS` - Email настройки
- `ADDR_TO/BCC_TO` - Email получатели

## Рекомендации

1. Запускайте тесты перед каждым коммитом
2. Добавляйте тесты для новой функциональности  
3. Поддерживайте высокое покрытие кода
4. Используйте понятные имена тестов
5. Группируйте связанные тесты в классы
