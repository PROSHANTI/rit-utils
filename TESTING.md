# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ RIT-Utils

## üìã –û–±–∑–æ—Ä

–î–ª—è –ø—Ä–æ–µ–∫—Ç–∞ RIT-Utils –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **pytest**. –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –≤—ã—Å–æ–∫—É—é –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞.

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ conftest.py                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest –∏ —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ test_auth_cookie_utils.py       # –¢–µ—Å—Ç—ã —É—Ç–∏–ª–∏—Ç –¥–ª—è cookies
‚îú‚îÄ‚îÄ test_auth_login.py              # –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ test_auth_two_factor.py         # –¢–µ—Å—Ç—ã 2FA
‚îú‚îÄ‚îÄ test_config.py                  # –¢–µ—Å—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ test_integration_endpoints.py   # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã API
‚îú‚îÄ‚îÄ test_main.py                    # –¢–µ—Å—Ç—ã –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–æ–¥—É–ª—è
‚îú‚îÄ‚îÄ test_utils_doctor_form.py       # –¢–µ—Å—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–æ—Ä–º –≤—Ä–∞—á–µ–π
‚îú‚îÄ‚îÄ test_utils_email.py             # –¢–µ—Å—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ email
‚îú‚îÄ‚îÄ test_utils_gen_cert.py          # –¢–µ—Å—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
‚îî‚îÄ‚îÄ README.md                       # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∞–º
```

## ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

### –ú–æ–¥—É–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ **–õ–æ–≥–∏–Ω/–ª–æ–≥–∞—É—Ç** (`src/auth/login.py`) - 17 —Ç–µ—Å—Ç–æ–≤
- ‚úÖ **–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** (`src/auth/two_factor.py`) - 18 —Ç–µ—Å—Ç–æ–≤  
- ‚úÖ **Cookie —É—Ç–∏–ª–∏—Ç—ã** (`src/auth/cookie_utils.py`) - 4 —Ç–µ—Å—Ç–∞

### –£—Ç–∏–ª–∏—Ç—ã
- ‚úÖ **–û—Ç–ø—Ä–∞–≤–∫–∞ email** (`src/utils/send_email/`) - 8 —Ç–µ—Å—Ç–æ–≤
- ‚úÖ **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤** (`src/utils/gen_cert/`) - 13 —Ç–µ—Å—Ç–æ–≤
- ‚úÖ **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–æ—Ä–º –≤—Ä–∞—á–µ–π** (`src/utils/doctor_form/`) - 11 —Ç–µ—Å—Ç–æ–≤

### –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- ‚úÖ **FastAPI endpoints** (`src/main.py`) - 25 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
- ‚úÖ **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (`src/config.py`) - 2 —Ç–µ—Å—Ç–∞
- ‚úÖ **–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å** - 10 —Ç–µ—Å—Ç–æ–≤

**–ò—Ç–æ–≥–æ: 106 —Ç–µ—Å—Ç–æ–≤**

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
./run_tests.sh

# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
./run_tests.sh auth

# –¢–æ–ª—å–∫–æ —É—Ç–∏–ª–∏—Ç—ã
./run_tests.sh utils

# –° –∞–Ω–∞–ª–∏–∑–æ–º –ø–æ–∫—Ä—ã—Ç–∏—è
./run_tests.sh coverage

# –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫
./run_tests.sh fast

# –°–ø—Ä–∞–≤–∫–∞
./run_tests.sh help
```

### –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ pytest
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
poetry run pytest

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª
poetry run pytest tests/test_auth_login.py

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
poetry run pytest tests/test_auth_login.py::TestLoginHandler::test_login_success_with_2fa_configured

# –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
poetry run pytest -v

# –¢–æ–ª—å–∫–æ —Å–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ (–±–µ–∑ –∑–∞–ø—É—Å–∫–∞)
poetry run pytest --collect-only
```

## üîß –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ú–æ–∫–∏ –∏ –∏–∑–æ–ª—è—Ü–∏—è
- **SMTP —Å–µ—Ä–≤–µ—Ä** - –≤—Å–µ email –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–º–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
- **LibreOffice** - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PPTX –≤ PDF –∑–∞–º–æ–∫–∏—Ä–æ–≤–∞–Ω–∞
- **–§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞** - —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞
- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** - —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –§–∏–∫—Å—Ç—É—Ä—ã
- `test_env` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `app` - —Ç–µ—Å—Ç–æ–≤–æ–µ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `client` - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `mock_request` - –º–æ–∫ –æ–±—ä–µ–∫—Ç–∞ Request
- `mock_smtp` - –º–æ–∫ SMTP —Å–µ—Ä–≤–µ—Ä–∞
- `mock_pptx` - –º–æ–∫ –¥–ª—è python-pptx

### –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏
- –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤ 2FA
- –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### pytest.ini
```ini
[tool:pytest]
testpaths = tests
addopts = -v --tb=short --strict-markers --disable-warnings --color=yes
markers =
    slow: marks tests as slow
    integration: marks tests as integration tests  
    unit: marks tests as unit tests
```

### –¢–µ—Å—Ç–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `JWT_SECRET_KEY` = `test_secret_key_for_jwt_tokens_12345`
- `LOGIN` = `test_admin`
- `PASSWORD` = `test_password`
- `TOTP_SECRET` = `TESTTOTP32CHARSSECRETFORTEST123456`
- `SEND_FROM` = `test@example.com`
- `EMAIL_PASS` = `test_password`
- `ADDR_TO` = `recipient@example.com`
- `BCC_TO` = `bcc@example.com`

## üéØ –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### Unit —Ç–µ—Å—Ç—ã
- –¢–µ—Å—Ç–∏—Ä—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –º–µ—Ç–æ–¥—ã
- –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ë—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã  
- –¢–µ—Å—Ç–∏—Ä—É—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP endpoints
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ flow –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ–∞–π–ª–æ–≤ —à–∞–±–ª–æ–Ω–æ–≤

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ë–µ–∑ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞** - —Ç–µ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –ø–æ–¥–Ω—è—Ç–∏—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. **–ë—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** - –≤—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–º–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
3. **–ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è** - —Ç–µ—Å—Ç—ã –Ω–µ –≤–ª–∏—è—é—Ç –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞
4. **–í—ã—Å–æ–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** - –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—É—Ç–∏
5. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∑–∞–ø—É—Å–∫–∞** - –æ–¥–∏–Ω —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

## üîç –ê–Ω–∞–ª–∏–∑ –ø–æ–∫—Ä—ã—Ç–∏—è

–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞:
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ coverage (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
poetry add pytest-cov --group test

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
./run_tests.sh coverage

# –†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –≤ htmlcov/index.html
```

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–µ—Å—Ç—ã** –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–∏—Ç–æ–º
2. **–î–æ–±–∞–≤–ª—è–π—Ç–µ —Ç–µ—Å—Ç—ã** –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
3. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å** —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–Ω—è—Ç–Ω—ã–µ –∏–º–µ–Ω–∞** –¥–ª—è —Ç–µ—Å—Ç–æ–≤
5. **–ì—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** –≤ –∫–ª–∞—Å—Å—ã

---

‚ú® –¢–µ—Å—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! –û–Ω–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
